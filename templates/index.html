<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI åˆ›å®¢æ•™è‚²åŠ©æ‰‹</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            align-items: start;
        }

        /* å·¦ä¾§è¾“å…¥åŒº */
        .input-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
        }

        h1 { font-size: 1.5rem; margin-top: 0; color: var(--primary); }

        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover { background-color: #1d4ed8; }
        button:disabled { background-color: #94a3b8; cursor: not-allowed; }

        /* å³ä¾§å±•ç¤ºåŒº */
        .result-panel {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: none; /* é»˜è®¤éšè— */
        }

        .header-info {
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .tags span {
            display: inline-block;
            background: #e0f2fe;
            color: #0369a1;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-right: 10px;
            margin-top: 10px;
        }

        /* å›¾ç‰‡åŒºåŸŸ */
        .image-container {
            width: 100%;
            height: 300px;
            background-color: #f1f5f9;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e2e8f0;
        }

        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
        }

        /* å†…å®¹åˆ—è¡¨ */
        h3 { color: var(--primary); margin-bottom: 10px; }

        ul, ol { padding-left: 20px; line-height: 1.6; }
        li { margin-bottom: 8px; }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            color: #64748b;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="input-panel">
            <h1>ğŸ› ï¸ åˆ›å®¢ä½œå“è®¾è®¡</h1>
            <p style="font-size: 0.9rem; color: #64748b;">è¾“å…¥ä½ çš„åˆ›æ„ï¼ŒAI å°†ä¸ºä½ ç”ŸæˆåŒ…å«ææ–™ã€æ­¥éª¤å’Œé¢„è§ˆå›¾çš„å®Œæ•´æ–¹æ¡ˆã€‚</p>

            <textarea id="userInput" placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³åšä¸€ä¸ªæ™ºèƒ½æµ‡èŠ±å™¨ï¼Œç»™å°å­¦ç”Ÿè®²è¯¾ç”¨..."></textarea>

            <button id="submitBtn" onclick="generate()">âœ¨ ç”Ÿæˆæ–¹æ¡ˆ</button>

            <div id="loading" class="loading">
                æ­£åœ¨æ€è€ƒè®¾è®¡æ–¹æ¡ˆ...<br>(çº¦éœ€ 10-30 ç§’)
            </div>
        </div>

        <div class="result-panel" id="resultPanel">
            <div class="header-info">
                <h2 id="p_name" style="margin: 0; font-size: 2rem;">é¡¹ç›®åç§°</h2>
                <div class="tags">
                    <span id="p_user">é€‚ç”¨äººç¾¤</span>
                    <span id="p_diff">éš¾åº¦</span>
                </div>
                <p id="p_idea" style="margin-top: 15px; color: #475569; font-style: italic;"></p>
            </div>

            <div class="image-container">
                <img id="p_image" src="" alt="ä½œå“é¢„è§ˆå›¾" onerror="this.src='[https://via.placeholder.com/800x400?text=Image+Load+Failed](https://via.placeholder.com/800x400?text=Image+Load+Failed)'">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3>ğŸ“¦ æ‰€éœ€ææ–™</h3>
                    <ul id="p_materials"></ul>
                </div>
                <div>
                    <h3>ğŸ¯ å­¦ä¹ ç›®æ ‡</h3>
                    <ul id="p_outcomes"></ul>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <h3>ğŸ”¨ åˆ¶ä½œæ­¥éª¤</h3>
                <ol id="p_steps"></ol>
            </div>
        </div>
    </div>

    <script>
        async function generate() {
            const input = document.getElementById('userInput').value;
            if (!input.trim()) return alert("è¯·è¾“å…¥ä½ çš„åˆ›æ„ï¼");

            // çŠ¶æ€åˆ‡æ¢
            const btn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const resultPanel = document.getElementById('resultPanel');

            btn.disabled = true;
            loading.style.display = 'block';
            resultPanel.style.display = 'none';

            try {
                const res = await fetch('/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idea: input })
                });

                const json = await res.json();

                if (json.success) {
                    renderData(json.data);
                } else {
                    alert("ç”Ÿæˆå¤±è´¥: " + json.error);
                }

            } catch (err) {
                alert("è¯·æ±‚å‡ºé”™: " + err);
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function renderData(data) {
            // å¡«å……æ–‡æœ¬
            document.getElementById('p_name').innerText = data.project_name || 'æœªå‘½åé¡¹ç›®';
            document.getElementById('p_user').innerText = 'ğŸ‘¤ ' + (data.target_user || 'é€šç”¨');
            document.getElementById('p_diff').innerText = 'ğŸ”¥ ' + (data.difficulty || 'æœªçŸ¥');
            document.getElementById('p_idea').innerText = data.core_idea || '';

            // å¡«å……å›¾ç‰‡
            // æ³¨æ„ï¼šå› ä¸ºå®Œå…¨ä¾èµ– AI è¿”å›çš„ URLï¼Œå¦‚æœ AI è¿”å›çš„æ˜¯å‡é“¾æ¥ï¼Œè¿™é‡Œå¯èƒ½ä¼šæ˜¾ç¤ºè£‚å›¾
            const imgEl = document.getElementById('p_image');
            if (data.clean_image_url) {
                imgEl.src = data.clean_image_url;
            } else {
                imgEl.src = '[https://via.placeholder.com/800x400?text=No+Image+Provided](https://via.placeholder.com/800x400?text=No+Image+Provided)';
            }

            // å¡«å……åˆ—è¡¨
            fillList('p_materials', data.materials);
            fillList('p_steps', data.steps);
            fillList('p_outcomes', data.learning_outcomes);

            // æ˜¾ç¤ºé¢æ¿
            document.getElementById('resultPanel').style.display = 'block';
        }

        function fillList(elementId, items) {
            const el = document.getElementById(elementId);
            el.innerHTML = ''; // æ¸…ç©º
            if (!items || items.length === 0) {
                el.innerHTML = '<li>æš‚æ— å†…å®¹</li>';
                return;
            }
            items.forEach(item => {
                const li = document.createElement('li');
                li.innerText = item;
                el.appendChild(li);
            });
        }
    </script>
</body>
</html>